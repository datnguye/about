<!DOCTYPE html>
<html lang="en">
<head>
    {% include "partials/google_analytics.html" %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page.title }} - {{ config.title }}</title>
    <meta name="description" content="{{ page.description | default(value=page.summary) | default(value='') }}">
    
    <!-- Open Graph meta tags -->
    <meta property="og:title" content="{{ page.title }}">
    <meta property="og:description" content="{{ page.description | default(value=page.summary) | default(value='') }}">
    <meta property="og:type" content="article">
    <meta property="og:url" content="{{ config.base_url }}{{ page.path }}">
    {% if page.extra.featured_image %}
    <meta property="og:image" content="{{ config.base_url }}{{ page.extra.featured_image }}">
    {% endif %}
    
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <!-- Preload critical assets -->
    <link rel="preload" href="/css/style.css" as="style">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/article.css">
    <link rel="stylesheet" href="/css/comments.css">
    <link rel="stylesheet" href="/css/related-articles.css">
    
    <!-- Only load syntax highlighting if needed -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9818368894527523"
         crossorigin="anonymous"></script>
</head>
<body class="bg-[var(--background)] text-[var(--text)] transition-colors duration-300 font-sans">
    <div class="absolute top-0 left-0 w-full h-full overflow-hidden -z-10">
        <div class="absolute top-20 left-10 w-40 h-40 rounded-full bg-[var(--primary)] opacity-10 floating"></div>
        <div class="absolute bottom-10 right-20 w-60 h-60 rounded-full bg-[var(--secondary)] opacity-10 floating" style="animation-delay: 2s;"></div>
        <div class="absolute top-1/3 right-1/4 w-32 h-32 rounded-full bg-[var(--primary)] opacity-10 floating" style="animation-delay: 4s;"></div>
    </div>

    <div class="container mx-auto px-4 py-8 max-w-5xl">
        <!-- Header with navigation -->
        <header class="mb-12">
            {% set current_path = page.path %}
            {% include "partials/navigation.html" %}
        </header>

        <!-- Article -->
        <article class="bg-[var(--card)] rounded-lg shadow-lg p-8 md:p-12">
            <!-- Article Header -->
            <header class="mb-8 pb-8 border-b border-[var(--text)] border-opacity-10">
                <h1 class="text-3xl md:text-4xl font-bold mb-4">{{ page.title }}</h1>
                
                <!-- Meta Information -->
                <div class="article-meta">
                    {% if page.date %}
                    <time datetime="{{ page.date | date(format='%Y-%m-%d') }}">
                        <i class="fas fa-calendar" aria-hidden="true"></i>
                        {{ page.date | date(format="%B %d, %Y") }}
                    </time>
                    {% endif %}
                    
                    {% if page.extra.author %}
                    <span>
                        <i class="fas fa-user" aria-hidden="true"></i>
                        {{ page.extra.author }}
                    </span>
                    {% endif %}
                    
                    {% if page.extra.read_time %}
                    <span>
                        <i class="fas fa-clock" aria-hidden="true"></i>
                        {{ page.extra.read_time }}
                    </span>
                    {% endif %}
                </div>

                <!-- Tags -->
                {% if page.extra.tags %}
                <div class="article-tags">
                    {% for tag in page.extra.tags %}
                    <span>#{{ tag }}</span>
                    {% endfor %}
                </div>
                {% endif %}
            </header>

            <!-- Table of Contents -->
            {% if page.extra.toc and page.toc %}
            <nav class="toc-nav">
                <h2 class="cursor-pointer" onclick="toggleTOC()">
                    <i class="fas fa-list"></i>
                    Table of Contents
                    <i id="toc-toggle-icon" class="fas fa-chevron-down ml-auto text-sm transition-transform duration-200"></i>
                </h2>
                <ul id="toc-content" class="space-y-2 max-h-96 overflow-y-auto">
                    {% for h1 in page.toc %}
                    <li>
                        <a href="#{{ h1.id }}" class="text-[var(--primary)] hover:opacity-80 transition-opacity">
                            {{ h1.title }}
                        </a>
                        {% if h1.children %}
                        <ul class="ml-4 mt-2 space-y-1">
                            {% for h2 in h1.children %}
                            <li>
                                <a href="#{{ h2.id }}" class="text-sm opacity-70 hover:opacity-100 hover:text-[var(--primary)] transition-all">
                                    {{ h2.title }}
                                </a>
                            </li>
                            {% endfor %}
                        </ul>
                        {% endif %}
                    </li>
                    {% endfor %}
                </ul>
            </nav>
            <script>
                function toggleTOC() {
                    const content = document.getElementById('toc-content');
                    const icon = document.getElementById('toc-toggle-icon');
                    
                    if (content.style.display === 'none') {
                        content.style.display = 'block';
                        icon.classList.remove('rotate-180');
                    } else {
                        content.style.display = 'none';
                        icon.classList.add('rotate-180');
                    }
                }
                
                // Optional: Start with TOC expanded
                // document.addEventListener('DOMContentLoaded', () => toggleTOC());
            </script>
            {% endif %}

            <!-- Content with In-Article Ads -->
            <div class="article-content" id="article-content">
                {{ page.content | safe }}
            </div>


            <!-- Article Footer -->
            <footer class="mt-12 pt-8 border-t border-[var(--text)] border-opacity-10">
                <!-- License Notice -->
                <div class="mb-8 text-left">
                    <p class="text-xs opacity-60">
                        <a href="https://creativecommons.org/licenses/by-nc/4.0/" 
                           target="_blank" 
                           rel="noopener noreferrer"
                           class="inline-flex items-center gap-1 hover:opacity-80 transition-opacity"
                           title="Creative Commons Attribution-NonCommercial 4.0">
                            Some rights reserved 
                            <i class="fas fa-info-circle" aria-hidden="true"></i>
                            <i class="fab fa-creative-commons" aria-hidden="true"></i>
                        </a>
                    </p>
                </div>
                <!-- Buy Me a Coffee -->
                <div class="mb-8">
                    <a href="https://www.buymeacoffee.com/datnguye" 
                       target="_blank" 
                       rel="noopener noreferrer"
                       class="inline-flex items-center gap-2 bg-[#FFDD00] text-black px-6 py-3 rounded-full font-semibold hover:bg-[#FFE666] transition-colors duration-300 shadow-lg hover:shadow-xl"
>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M20.216 6.415l-.132-.666c-.119-.598-.388-1.163-1.001-1.379-.197-.069-.42-.098-.57-.241-.152-.143-.196-.366-.231-.572-.065-.378-.125-.756-.192-1.133-.057-.325-.102-.69-.25-.987-.195-.4-.597-.634-.996-.788a5.723 5.723 0 00-.626-.194c-1-.263-2.05-.36-3.077-.416a25.834 25.834 0 00-3.7.062c-.915.083-1.88.184-2.75.5-.318.116-.646.256-.888.501-.297.302-.393.77-.177 1.146.154.267.415.456.692.58.36.162.737.284 1.123.366 1.075.238 2.189.331 3.287.37 1.218.05 2.437.01 3.65-.118.299-.033.598-.073.896-.119.352-.054.578-.513.474-.834-.124-.383-.457-.531-.834-.473-.466.074-.96.108-1.382.146-1.177.08-2.358.082-3.536.006a22.228 22.228 0 01-1.157-.107c-.086-.01-.18-.025-.258-.036-.243-.036-.484-.08-.724-.13-.111-.027-.111-.185 0-.212h.005c.277-.06.557-.108.838-.147h.002c.131-.009.263-.032.394-.048a25.076 25.076 0 013.426-.12c.674.019 1.347.067 2.017.144l.228.031c.267.04.533.088.798.145.392.085.895.113 1.07.542.055.137.08.288.111.431l.319 1.484a.237.237 0 01-.199.284h-.003c-.037.006-.075.01-.112.015a36.704 36.704 0 01-4.743.295 37.059 37.059 0 01-4.699-.304c-.14-.017-.293-.042-.417-.06-.326-.048-.649-.108-.973-.161-.393-.065-.768-.032-1.123.161-.29.16-.527.404-.675.701-.154.316-.199.66-.267 1-.069.34-.176.707-.135 1.056.087.753.613 1.365 1.37 1.502a39.69 39.69 0 0011.343.376.483.483 0 01.535.53l-.071.697-1.018 9.907c-.041.41-.047.832-.125 1.237-.122.637-.553 1.028-1.182 1.171-.577.131-1.165.2-1.756.205-.656.004-1.31-.025-1.966-.022-.699.004-1.556-.06-2.095-.58-.475-.458-.54-1.174-.605-1.793l-.731-7.013-.322-3.094c-.037-.351-.286-.695-.678-.678-.336.015-.718.3-.678.679l.228 2.185.949 9.112c.147 1.344 1.174 2.068 2.446 2.272.742.12 1.503.144 2.257.156.966.016 1.942.053 2.892-.122 1.408-.258 2.465-1.198 2.616-2.657.34-3.332.683-6.663 1.024-9.995l.215-2.087a.484.484 0 01.39-.426c.402-.078.787-.212 1.074-.518.455-.488.546-1.124.385-1.766zm-1.478.772c-.145.137-.363.201-.578.233-2.416.359-4.866.54-7.308.46-1.748-.06-3.477-.254-5.207-.498-.17-.024-.353-.055-.47-.18-.22-.236-.111-.71-.054-.995.052-.26.152-.609.463-.646.484-.057 1.046.148 1.526.22.577.088 1.156.159 1.737.212 2.48.226 5.002.19 7.472-.14.45-.06.899-.13 1.345-.21.399-.072.84-.206 1.08.206.166.281.188.657.162.974a.544.544 0 01-.169.364zm-6.159 3.9c-.862.37-1.84.788-3.109.788a5.884 5.884 0 01-1.569-.217l.877 9.004c.065.78.717 1.38 1.5 1.38 0 0 1.243.065 1.658.065.447 0 1.786-.065 1.786-.065.783 0 1.434-.6 1.499-1.38l.94-9.95a3.996 3.996 0 00-1.322-.238c-.826 0-1.491.284-2.26.613z"/>
                        </svg>
                        Buy Me a Coffee
                    </a>
                    <p class="mt-3 text-sm opacity-70">🚀 Did this article save your bacon? Help me keep the caffeine flowing! 💻✨</p>
                </div>

                <div class="flex flex-wrap justify-between items-center gap-4">
                    <!-- Share buttons -->
                    <div class="share-buttons">
                        <span class="text-sm opacity-70">Share:</span>
                        <a href="https://www.facebook.com/sharer/sharer.php?u={{ config.base_url }}{{ page.path }}" 
                           target="_blank" 
                           rel="noopener noreferrer"
                           aria-label="Share on Facebook">
                            <i class="fab fa-facebook" aria-hidden="true"></i>
                        </a>
                        <a href="https://twitter.com/intent/tweet?text={{ page.title | urlencode }}&url={{ config.base_url }}{{ page.path }}" 
                           target="_blank" 
                           rel="noopener noreferrer"
                           aria-label="Share on Twitter">
                            <i class="fab fa-twitter" aria-hidden="true"></i>
                        </a>
                        <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ config.base_url }}{{ page.path }}" 
                           target="_blank" 
                           rel="noopener noreferrer"
                           aria-label="Share on LinkedIn">
                            <i class="fab fa-linkedin" aria-hidden="true"></i>
                        </a>
                    </div>

                    <!-- Back to blog -->
                    <a href="/blog" class="text-sm text-[var(--primary)] hover:opacity-80 transition-opacity inline-flex items-center gap-2">
                        <i class="fas fa-arrow-left"></i>
                        Back to Blog
                    </a>
                </div>
            </footer>
        </article>

        <!-- Navigation between posts -->
        <nav class="article-nav">
            {% if page.earlier %}
            <a href="{{ page.earlier.permalink }}">
                <i class="fas fa-chevron-left"></i>
                <span class="hidden sm:inline">{{ page.earlier.title | truncate(length=30) }}</span>
                <span class="sm:hidden">Previous</span>
            </a>
            {% else %}
            <div></div>
            {% endif %}

            {% if page.later %}
            <a href="{{ page.later.permalink }}">
                <span class="hidden sm:inline">{{ page.later.title | truncate(length=30) }}</span>
                <span class="sm:hidden">Next</span>
                <i class="fas fa-chevron-right"></i>
            </a>
            {% else %}
            <div></div>
            {% endif %}
        </nav>

        <!-- Comments Section -->
        <div class="comments-container">
            <div class="comments-header">
                <h2><i class="fas fa-comments"></i> Comments</h2>
                <p>Join the discussion! Your thoughts and feedback are valuable.</p>
            </div>
            <div class="comments-info">
                <p>💡 Comments are powered by GitHub Discussions. You'll need a GitHub account to comment. Make sure Discussions are enabled in the repository.</p>
            </div>
            <div id="comments-section">
                <div class="comments-loading">
                    <i class="fas fa-spinner"></i>
                    Loading comments...
                </div>
            </div>
        </div>

        {% include "partials/related-articles.html" %}

        {% include "partials/footer.html" %}
    </div>

    <script src="/js/search.js"></script>
    <script src="/js/script.js"></script>
    <script src="/js/comments.js"></script>
    <script src="/js/related-articles.js"></script>
    
    <!-- Article Ads Script -->
    {% if page.extra.show_ads is not defined or page.extra.show_ads %}
    <script src="/js/article-ads.js"></script>
    {% endif %}
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-sql.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-yaml.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js" defer></script>
    
    <!-- Cookie Consent -->
    {% include "partials/cookie_consent.html" %}
    
    <!-- Back to Top Button -->
    <button 
        id="back-to-top"
        onclick="window.scrollTo({top: 0, behavior: 'smooth'})"
        class="fixed bottom-6 right-6 bg-[var(--primary)] text-white w-12 h-12 rounded-full shadow-lg hover:shadow-xl transition-all duration-300 opacity-0 invisible"
        aria-label="Back to top"
    >
        <i class="fas fa-chevron-up"></i>
    </button>
    
    <script>
        // Show/hide back to top button based on scroll position
        const backToTopButton = document.getElementById('back-to-top');
        
        window.addEventListener('scroll', () => {
            if (window.scrollY > 300) {
                backToTopButton.classList.remove('opacity-0', 'invisible');
                backToTopButton.classList.add('opacity-100', 'visible');
            } else {
                backToTopButton.classList.remove('opacity-100', 'visible');
                backToTopButton.classList.add('opacity-0', 'invisible');
            }
        });
    </script>
</body>
</html>